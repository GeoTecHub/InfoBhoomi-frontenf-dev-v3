<app-user-authenticator></app-user-authenticator>

<div class="header-container">
  <app-admin-header></app-admin-header>
</div>

<div class="admin-main-body">
  <div class="side-panel-container">
    <app-admin-side-bar></app-admin-side-bar>
  </div>

  <div class="tab-container mt-3 mx-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center justify-content-between w-100 mb-3 flex-wrap">
          <div style="display: flex; gap: 11px; margin-left: auto">
            <button
              mat-icon-button
              matSuffix
              [routerLink]="['/admin-organizations-create']"
              class="admin-primary-bg-btn"
            >
              <mat-icon class="me-1">add</mat-icon> Create New Organization
            </button>
          </div>
        </div>

        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Contact No.</th>
              <th scope="col">Permit Expires On</th>
              <th scope="col">Subscription Plan</th>
              <th scope="col">Users Limit</th>
              <th scope="col" class="text-center">Active</th>
              <th scope="col" style="text-align: center; max-width: 320px; width: 320px">
                Actions
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let org of organizations_list">
              <td>
                {{ org.display_name }}
                <ng-container *ngIf="this.user_org === org.org_id">
                  <span
                    class="org-dot"
                    matTooltip="Current organization"
                    matTooltipPosition="above"
                    aria-label="Current organization"
                    role="img"
                  ></span>
                </ng-container>
              </td>
              <td>{{ org.contact_no ?? '-' }}</td>
              <td>
                {{ org.permit_end_date ? (org.permit_end_date | date: 'dd/MM/yyyy') : '-' }}
                <span *ngIf="isPermitExpired(org.permit_end_date)" class="permit-expired-badge"
                  >Expired</span
                >
              </td>
              <td>{{ org.subscription_plan }}</td>
              <td>{{ org.users_limit ?? '-' }}</td>
              <td class="checkbox-cell">
                <input
                  type="checkbox"
                  [checked]="org.status"
                  (change)="toggleStatus($event, org)"
                  class="styled-checkbox"
                  [ngClass]="{
                    'green-checkbox': org.status,
                    'red-checkbox': !org.status,
                  }"
                />
              </td>
              <td style="text-align: center; max-width: 200px; width: 200px">
                <div class="d-flex align-items-center gap-3 justify-content-between">
                  <a
                    (click)="updateLocation(org)"
                    class="link-text"
                    [ngClass]="org.org_loc ? 'update-loc-btn' : 'set-loc-btn'"
                    style="width: 100px"
                  >
                    <span *ngIf="org.org_loc"> Update Location </span>
                    <span *ngIf="!org.org_loc"> Set Location </span>
                  </a>

                  <a
                    (click)="updateArea(org)"
                    class="link-text"
                    [ngClass]="org.org_area ? 'update-loc-btn' : 'set-loc-btn'"
                    style="width: 100px"
                  >
                    <span *ngIf="org.org_area"> Update Area </span>
                    <span *ngIf="!org.org_area"> Set Area </span>
                  </a>

                  <a (click)="showOrganization(org)" class="link-text"> More Info</a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
